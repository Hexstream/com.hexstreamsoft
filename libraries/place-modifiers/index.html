<!DOCTYPE html>

<html>
  <head>
    <meta charset="UTF-8" />
    <title>place-modifiers | Libraries | HexstreamSoft</title>
    <link href="../../global.css" rel="stylesheet" type="text/css" />
    <link href="../libraries.css" rel="stylesheet" type="text/css" />
    <script src="http://use.edgefonts.net/sanvito-pro-display.js"></script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1783234-3']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>

    <nav id="site-nav">

      <nav class="breadcrumbs">
        <a href="../../">HexstreamSoft</a>
        <span class="separator"> » </span>
        <a href="../">Libraries</a>
        <span class="separator"> » </span>
        <a href="../categories/macros/">Macros</a>
        <span class="separator"> » </span>
        <a href="../categories/macros/extensible/">Extensible</a>
        <span class="separator"> » </span>
        <a class="here">place-modifiers</a>
        <div class="float-clear"></div>
      </nav>

      <nav class="ancestors-nav">

        <div class="level-separator"></div>

        <nav class="navbox" id="library_navbox">
          <h1>
            <a class="here">place-modifiers</a>
            <span class="here-indicator-left"> </span>
            <span class="here-indicator-right"> </span>
          </h1>
          <ul>
            <li><a href="#trivial-examples">3 trivial examples</a></li>
            <li><a href="#hundreds-of-modify-macros">100's modify-macros</a></li>
            <li><a href="#why-not-by-hand">Why not by hand?</a></li>
            <li><a href="#modify-return-values"><code class="common-lisp library macro operator">modify</code> return values</a></li>
            <li>
              <a href="#place-modification-expression-vs-place" class="inlining-node"><abbr title="place-modification-expression">PME</abbr> VS place</a>
              <ul class="inlined-nodes">
                <li><a href="#conservative-recursion-through-spots">Conservative spots</a></li>
                <li><a href="#inconceivable-places">Inconceivable places</a></li>
                <li><a href="#explicit-place">Explicit <code class="common-lisp library marker">:place</code></a></li>
                <li><a href="#top-level">Top-level</a></li>
              </ul>
            </li>

            <li><a href="#multiple-place-modification-expressions">Multiple <abbr title="place-modification-expression">PME</abbr>s</a></li>
            <li><a href="#place-modifier-variants">Place-modifier variants</a></li>
            <li><a href="#variants-statistics">Variants statistics</a></li>
          </ul>
          <ul>
            <li><a href="../../worknotes/#place-modifiers">Worknotes</a></li>
          </ul>
        </nav>

        <div class="level-separator"></div>

        <nav class="navbox" id="extensible-macro-projects_navbox">
          <h1>
            <a href="../categories/macros/extensible/">Extensible macros</a>
          </h1>
          <ul>
            <li><a href="../cartesian-product-switch/">cartesian-product-switch</a></li>
            <li>
              <a class="here">
                place-modifiers
                <span class="here-indicator-left"> </span>
                <span class="here-indicator-right"> </span>
              </a>
            </li>
            <li><a href="../anaphoric-variants/">anaphoric-variants</a></li>
            <li><a href="../multiple-value-variants/">multiple-value-variants</a></li>
          </ul>
        </nav>

        <div class="level-separator"></div>

        <nav class="navbox" id="macros_projects_navbox">
          <h1>
            <a href="../categories/macros/">Macros</a>
          </h1>
          <ul>
            <li><a href="../categories/macros/simple/">Simple</a></li>
            <li>
              <a href="../categories/macros/extensible/">
                Extensible
                <span class="here-indicator-left"> </span>
                <span class="here-indicator-right"> </span>
              </a>
            </li>
            <li><a href="../categories/macros/utilities/">Utilities</a></li>
          </ul>
        </nav>

        <div class="level-separator"></div>

        <nav class="navbox" id="projects_navbox">
          <h1>
            <a href="../">Libraries</a>
          </h1>
          <ul>
            <li><a href="../categories/macros/">Macros <span class="here-indicator-left"> </span> <span class="here-indicator-right"></span></a></li>
            <li><a href="../categories/data-structures/">Data structures</a></li>
            <li><a href="../categories/uncategorized/">Uncategorized</a></li>
          </ul>
        </nav>

        <div class="level-separator"></div>

        <nav class="navbox" id="main_navbox">
          <h1>
            <a href="../../">HexstreamSoft</a>
          </h1>
          <ul>
            <li><a href="../../introduction.html">Introduction</a></li>
            <li><a href="../">Libraries <span class="here-indicator-left"> </span> <span class="here-indicator-right"> </span></a></li>
            <li><a href="../../tweets/">Tweets</a></li>
            <li><a href="../../worknotes/">Worknotes</a></li>
            <li><a href="../../accounts/">Accounts</a></li>
            <li><a href="../../resources/">Resources</a></li>
          </ul>
        </nav>

      </nav>

    </nav>

    <div id="content">

      <header id="page-header">
        <h1>place-modifiers</h1>
        <p class="description">An operator overlay macro in Quicklisp.</p>
      </header>

      <div id="project-info">
        <table class="factsheet">
          <tbody>
            <tr>
              <th class="project-type property">Project Type</th>
              <td class="project-type" colspan="2">Library</td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <th class="library-programming-language property">Programming language</th>
              <td class="library-programming-language" colspan="2">Common Lisp</td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <th class="project-status property">Status</th>
              <td class="project-status good-news" colspan="2">Ready-to-use</td>
            </tr>
            <tr>
              <th class="project-license property"><a href="https://github.com/Hexstream/place-modifiers/blob/master/UNLICENSE">License</a></th>
              <td class="project-license good-news" colspan="2"><a href="../../resources/#unlicense">Public Domain</a></td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <th class="library-type property">Library type</th>
              <td class="library-type" colspan="2">Operator overlay macro</td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <th class="project-complexity property">Project complexity</th>
              <td class="project-complexity" colspan="2">Simple/Medium</td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <th class="project-latest-release" rowspan="2"><a href="place-modifiers_latest.tar.gz">Latest release</a></th>
              <th class="project-latest-release-version property">Version</th>
              <td class="project-latest-release-version">2.1</td>
            </tr>
            <tr>
              <th class="project-latest-release-date property">Date</th>
              <td class="project-latest-release-date">22 oct 2012</td>
            </tr>
          </tbody>
          <tbody>
            <tr>
              <th class="project-quicklisp" rowspan="2">
                Quicklisp
                <br />
                <span class="as-of-dist">(<a href="http://blog.quicklisp.org/2012/11/november-2012-quicklisp-dist-update-now.html">Nov 2012 dist</a> and later)</span>
              </th>
              <th class="project-quicklisp-status property">Status</th>
              <td class="project-quicklisp-status good-news">Available</td>
            </tr>
            <tr>
              <th class="project-quicklisp-version property">Version</th>
              <td class="project-quicklisp-version good-news">Latest</td>
            </tr>
          </tbody>

        </table>

        <nav class="navbox" id="external-projects_navbox">
          <h1>
            External library pages
          </h1>
          <ul>
            <li><a href="http://github.com/Hexstream/place-modifiers">Github</a></li>
            <li><a href="http://quickdocs.org/place-modifiers">Quickdocs</a></li>
            <li><a href="http://cliki.net/place-modifiers">CLiki</a></li>
            <li><a href="http://common-lisp.net/project/cl-test-grid/library/place-modifiers.html">cl-test-grid</a></li>
          </ul>
        </nav>

        <table id="dependencies-table">
          <thead>
            <tr>
              <th></th>
              <th>Depends on</th>
              <th>Depended on by</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>Directly</th>
              <td>
                <ul>
                  <li><a href="../map-bind/">map-bind</a></li>
                  <li><a href="../cartesian-product-switch/">cartesian-product-switch</a></li>
                </ul>
              </td>
              <td>
                Nothing
              </td>
            </tr>
            <tr>
              <th>Indirectly</th>
              <td>Nothing</td>
              <td>Nothing</td>
            </tr>
          </tbody>
        </table>

      </div>

      <p><cite class="common-lisp library">place-modifiers</cite> essentially gives access to hundreds of modify-macros through one single macro: <code class="common-lisp library macro operator">modify</code>.</p>

      <p><b>To use place-modifiers, simply <code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defpkg.htm">:import-from</a> #:place-modifiers #:modify)</code>. Don't <code>(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defpkg.htm">:use</a>)</code>!</b></p>

      <p>(Things start a bit slowly, but don't worry, it gets more and more interesting!)</p>

      <section id="trivial-examples">

        <h1><a href="#trivial-examples" class="anchor">&#x2693;</a> 3 trivial examples</h1>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> 7))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">1+</code> <var>place</var>))
  <var>place</var>)
==
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> 7))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_incf_.htm">incf</a> <var>place</var>)
  <var>place</var>)
=&gt; 8</code></pre>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> '(old)))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">cons</code> 'new <var>place</var>))
  <var>place</var>)
==
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> '(old)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_push.htm">push</a> 'new <var>place</var>)
  <var>place</var>)
=&gt; (NEW OLD)</code></pre>

        <pre class="example"><code class="common-lisp">;; Reminder for newbies: <a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_stgeq_.htm">string-equal</a> is case-insensitive comparison.
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> '(<code class="string">"hello"</code> <code class="string">"hi"</code>)))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">adjoin</code> <code class="string">"HELLO"</code> <var>place</var> :test #'<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_stgeq_.htm">string-equal</a>))
  <var>place</var>)
==
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> '(<code class="string">"hello"</code> <code class="string">"hi"</code>)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_pshnew.htm">pushnew</a> <code class="string">"HELLO"</code> <var>place</var> :test #'<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_stgeq_.htm">string-equal</a>)
  <var>place</var>)
=&gt; (<code class="string">"hello"</code> <code class="string">"hi"</code>)</code></pre>

      </section>

      <section id="hundreds-of-modify-macros">

        <h1><a href="#hundreds-of-modify-macros" class="anchor">&#x2693;</a> Equivalent to hundreds of modify macros!</h1>

        <p>Not very exciting so far. But <code class="common-lisp standard macro operator"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_incf_.htm">incf</a></code>, <code class="common-lisp standard macro operator"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_push.htm">push</a></code> and <code class="common-lisp standard macro operator"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_pshnew.htm">pushnew</a></code> give you access to 3 modify-macros, whereas <code class="common-lisp library macro operator">modify</code> gives you access to literally <em>hundreds</em>!</p>

        <pre class="example"><code class="common-lisp">;; Traditionally "nreversef"
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 1 2 3)))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">nreverse</code> <var>place</var>))
  <var>place</var>)
=&gt; (3 2 1)</code></pre>

        <pre class="example"><code class="common-lisp">;; "string-upcasef"?...
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> <code class="string">"Yay"</code>))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">string-upcase</code> <var>place</var>))
  <var>place</var>)
=&gt; <code class="string">"YAY"</code></code></pre>

        <pre class="example"><code class="common-lisp">;; "listf"?
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> 'atom))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">list</code> <var>place</var>))
  <var>place</var>)
=&gt; (ATOM)</code></pre>

        <pre class="example"><code class="common-lisp">;; "class-off"?
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> 'symbol))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">class-of</code> <var>place</var>))
  <var>place</var>)
=&gt; #&lt;<a href="http://www.lispworks.com/documentation/HyperSpec/Body/t_built_.htm">BUILT-IN-CLASS</a> <a href="http://www.lispworks.com/documentation/HyperSpec/Body/t_symbol.htm">SYMBOL</a>&gt;</code></pre>

        <pre class="example"><code class="common-lisp">;; "parse-integerf"?
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> <code class="string">"1986"</code>))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">parse-integer</code> <var>place</var>))
  <var>place</var>)
=&gt; 1986</code></pre>

      </section>

      <section id="why-not-by-hand">

        <h1><a href="#why-not-by-hand" class="anchor">&#x2693;</a> Why not just write it out by hand?</h1>

        <p>One might wonder, why not just write this instead?</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 1 2 3)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_setf_.htm">setf</a> <var>place</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_revers.htm">nreverse</a> <var>place</var>))
  <var>place</var>)
;; instead of
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 1 2 3)))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">nreverse</code> <var>place</var>))
  <var>place</var>)</code></pre>

        <p>(And forget about <code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_revers.htm">nreverse</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 1 2 3))</code> or <code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 3 2 1)</code> because that's missing the point. ;P) The answer is that "place" might of course be much longer-named and/or more complex than this. And of course, multiple evaluation of the place will be averted, which is important when side-effects and/or expensive accesses are involved.</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>my-list-of-three-elements</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 1 2 3)))
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">nreverse</code> <var>my-list-of-three-elements</var>))
  <var>my-list-of-three-elements</var>)
==
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>my-list-of-three-elements</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_list_.htm">list</a> 1 2 3)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_setf_.htm">setf</a> <var>my-list-of-three-elements</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_revers.htm">nreverse</a> <var>my-list-of-three-elements</var>))
  <var>my-list-of-three-elements</var>)</code></pre>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>hash</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_mk_has.htm">make-hash-table</a>)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_setf_.htm">setf</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> 'key <var>hash</var>) 10)
  (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">/</code> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_wr_pr.htm">print</a> 'key) <var>hash</var>) 5))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> 'key <var>hash</var>))
==
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>hash</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_mk_has.htm">make-hash-table</a>)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_setf_.htm">setf</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> 'key <var>hash</var>) 10)
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((key (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_wr_pr.htm">print</a> 'key)))
    (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_setf_.htm">setf</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> key <var>hash</var>) (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_sl.htm">/</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> key <var>hash</var>) 5)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_gethas.htm">gethash</a> 'key <var>hash</var>))
-| KEY
=&gt; 2, T</code></pre>

      </section>

      <section id="modify-return-values">

        <h1><a href="#modify-return-values" class="anchor">&#x2693;</a> <code class="common-lisp library macro operator">modify</code> return values, <code class="common-lisp library marker">:old</code></h1>

        <p><code class="common-lisp library macro operator">modify</code> normally returns the new value(s) of the place, per the usual conventions:</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> 2))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">expt</code> <var>place</var> 8))
          <var>place</var>))
=&gt; 256, 256</code></pre>

        <p>But one simple yet very useful feature is to be able to return the old value instead:</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>place</var> 2))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">expt</code> <var>place</var> 8)))
          <var>place</var>))
=&gt; 2, 256</code></pre>

      </section>

      <section id="place-modification-expression-vs-place">

        <h1><a href="#place-modification-expression-vs-place" class="anchor">&#x2693;</a> place-modification-expression VS place</h1>

        <p>Some place-modifiers are also valid places. One example is <code class="common-lisp standard macro operator"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_aref.htm">aref</a></code>. In the following example, how does <code class="common-lisp library macro operator">modify</code> know which of <code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_aref.htm">aref</a> <var>object</var> 0)</code> or <var>object</var> should be interpreted as being the place to modify?</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>object</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_vector.htm">vector</a> 'e)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">list</code> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_aref.htm">aref</a> <var>object</var> 0))))
          <var>object</var>))
=&gt; E, #((E))
or #(E), (E) ?</code></pre>

        <section id="conservative-recursion-through-spots">

        <h1><a href="#conservative-recursion-through-spots" class="anchor">&#x2693;</a> Conservative recursion through "spots" by default</h1>

        <p>It's simple: <code class="common-lisp library macro operator">modify</code> is "conservative" by default, so as soon as it encounters a possible place while recursing through the "spots" (described and explained below), then it will treat that as the place. This is the most intuitive possible default and is usually what you want.</p>

        <p>In the above example, <code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_aref.htm">aref</a> <var>object</var> 0)</code> is the place to modify, not <var>object</var>.</p>

      </section>

      <section id="inconceivable-places">

        <h1><a href="#inconceivable-places" class="anchor">&#x2693;</a> Inconceivable places</h1>

        <p>Some place-modifiers are known to <code class="common-lisp library macro operator">modify</code> as being "inconceivable places", which allows conservative recursion to proceed (at least) one step further, much conveniently:</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>list</var> '((d . 4))))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">cons</code> 'first (<code class="common-lisp library marker">list*</code> 'a 1 'b 2 (<code class="common-lisp library marker">acons</code> 'c 3 <var>list</var>)))))
          <var>list</var>))
=&gt; ((D . 4)), (FIRST A 1 B 2 (C . 3) (D . 4))</code></pre>

      </section>

      <section id="explicit-place">

        <h1><a href="#explicit-place" class="anchor">&#x2693;</a> Speculative recursion through "spots" in search of explicit :place form</h1>

        <p>After finding the <a href="#conservative-recursion-through-spots">most conservative place</a>, <code class="common-lisp library macro operator">modify</code> will still speculatively recurse through the remaining "spots" in search of a <code class="common-lisp library marker">:place</code> "local special form", which would explicitly indicate at what level lies the intended place, overriding the conservative behavior.</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>object</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_vector.htm">vector</a> 'e)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">list</code> (<code class="common-lisp library marker">aref</code> (<code class="common-lisp library marker">:place</code> <var>object</var>) 0))))
          <var>object</var>))
=&gt; #(E), (E)</code></pre>

      </section>

      <section id="top-level">

        <h1><a href="#top-level" class="anchor">&#x2693;</a>Possible place at top-level: treated as place-modification-expression</h1>

        <p>Of course, the "top-level" (ignoring <code class="common-lisp library marker">:old</code>) of <code class="common-lisp library macro operator">modify</code> can only accept a place-modification-expression and not a place, so there can be no ambiguity there:</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>object</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_vector.htm">vector</a> 'e)))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">aref</code> (<code class="common-lisp library marker">:place</code> <var>object</var>) 0)))
          <var>object</var>))
=&gt; #(E), E</code></pre>

      </section>

      </section>

      <section id="multiple-place-modification-expressions">

        <h1><a href="#multiple-place-modification-expressions" class="anchor">&#x2693;</a> Multiple place-modification-expressions: <code class="common-lisp standard macro operator"><a href="http://www.lispworks.com/documentation/hyperspec/body/m_setf_.htm">setf</a></code>-like</h1>

        <p><code class="common-lisp library macro operator">modify</code> can accept multiple place-modification-expressions, in which case the modifications will happen in sequence, much in the same way as <code class="common-lisp standard macro operator"><a href="http://www.lispworks.com/documentation/hyperspec/body/m_setf_.htm">setf</a></code> with multiple places.</p>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>x</var> 'a) (<var>y</var> 'b))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">list</code> <var>x</var>)
                  (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">cons</code> <var>y</var> <var>x</var>)))
          <var>x</var>
          <var>y</var>))
==
(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>x</var> 'a) (<var>y</var> 'b))
  (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm">values</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_progn.htm">progn</a> (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">list</code> <var>x</var>))
                 (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">:old</code> (<code class="common-lisp library marker">cons</code> <var>y</var> <var>x</var>))))
          <var>x</var>
          <var>y</var>))
=&gt; (A), (B A), B</code></pre>

      </section>

      <section id="place-modifier-variants">

        <h1><a href="#place-modifier-variants" class="anchor">&#x2693;</a> Place-modifier variants</h1>

        <p>Up to this point, we've always used the "primary variant", which is the one you'll need most often, but each place-modifier kind can have up to 4 variants, though most only have one or two. The "variant" determines which argument is treated as the "spot", positionally.</p>

        <p>The determination of which variant maps to which spot is made by the definer of the place-modifier.</p>

      </section>

      <section id="variants-statistics">

        <h1><a href="#variants-statistics" class="anchor">&#x2693;</a> Some statistics about place-modifier variants</h1>

        <pre class="example"><code class="common-lisp">(<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm">let</a> ((<var>variant-counts</var> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_vector.htm">vector</a> 0 0 0 0)))
  (<code class="common-lisp library function operator">place-modifiers:map-infos</code>
   (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_lambda.htm">lambda</a> (<var>name</var> <var>info</var>)
     (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_declar.htm">declare</a> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/d_ignore.htm">ignore</a> <var>name</var>))
     (<code class="common-lisp library macro operator">modify</code> (<code class="common-lisp library marker">1+</code> (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_aref.htm">aref</a> <var>variant-counts</var>
                       (1- (length (<code class="common-lisp library function operator">place-modifiers:spot-indexes</code> <var>info</var>))))))))
  <var>variant-counts</var>)
=&gt; #(301 172 35 2)</code></pre>

        <p>So as of version 2.1, there are 301 place-modifiers with one single variant, 172 with 2 variants, and only 37 with 3 or 4 variants.</p>

      </section>

    </div>

    <div id="footer">
      <div>
        <a href="#" class="back-to-top">⬆</a>
        <span class="page-badge"><a href="http://validator.w3.org/check?uri=http%3A%2F%2Fwww.hexstreamsoft.com%2Flibraries%2Fplace-modifiers%2F"><span class="checkmark">✔</span> HTML5</a></span>
        <span class="page-badge"><a href="http://www.hexstreamsoft.com/README"><span class="checkmark">✔</span> Public Domain</a></span>
        <span class="page-badge"><a href="http://jigsaw.w3.org/css-validator/validator?uri=http%3A%2F%2Fwww.hexstreamsoft.com%2Flibraries%2Fplace-modifiers%2F"><span class="checkmark">✔</span> CSS3</a></span>
      </div>
    </div>

  </body>
</html>
