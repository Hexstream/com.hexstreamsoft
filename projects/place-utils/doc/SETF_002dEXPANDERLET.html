<html lang="en">
<head>
<title>SETF-EXPANDERLET - Place-utils Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Place-utils Manual">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Reference.html#Reference" title="Reference">
<link rel="prev" href="Quick-Reference.html#Quick-Reference" title="Quick Reference">
<link rel="next" href="WITH_002dRESOLVED_002dPLACES.html#WITH_002dRESOLVED_002dPLACES" title="WITH-RESOLVED-PLACES">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This manual documents place-utils, which is a Common Lisp library that
provides a few utilities relating to setfable places.

The project's home is `http://www.hexstreamsoft.com/projects/place-utils'.

Originally authored by Jean-Philippe Paradis <hexstream@gmail.com>.

This project is in the public domain.
See the Unlicense appendix for details.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<a name="SETF-EXPANDERLET"></a>
<a name="SETF_002dEXPANDERLET"></a>
<p>
Next:&nbsp;<a rel="next" accesskey="n" href="WITH_002dRESOLVED_002dPLACES.html#WITH_002dRESOLVED_002dPLACES">WITH-RESOLVED-PLACES</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Quick-Reference.html#Quick-Reference">Quick Reference</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Reference.html#Reference">Reference</a>
<hr>
</div>

<h3 class="section">1.2 <code>setf-expanderlet</code></h3>

<div class="defun">
&mdash; Macro: <b>setf-expanderlet</b> (<var>&amp;rest bindings</var>)<var> &amp;body body &rArr; results<a name="index-setf_002dexpanderlet-1"></a></var><br>
<blockquote><p><code>setf-expanderlet</code> introduces local setf-expanders. This opens
possibilities for more complex local setf-expanders than can be
handled by Common Lisp's built-in support for local <code>setf</code>
functions (which must evaluate all their arguments once from left to
right and can only accept one new value at a time).

        <p><code>setf-expanderlet</code> is to <code>define-setf-expander</code> as
<code>macrolet</code> is to <code>defmacro</code>. The <var>bindings</var> of
<code>setf-expanderlet</code> have much the same semantics as their
counterparts in <code>macrolet</code>, except the job of each expander is to
return a <code>setf</code> expansion (5 values), not a normal expansion (a
form).

        <p><a href="http://www.lispworks.com/documentation/HyperSpec/Body/05_aab.htm">CLHS 5.1.1.2 Setf Expansions</a>

        <p><a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defi_3.htm">CLHS <code>define-setf-expander</code></a>

        <p><a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_flet_.htm">CLHS <code>macrolet</code></a>

        <p><a href="http://www.lispworks.com/documentation/HyperSpec/Body/m_defmac.htm">CLHS <code>defmacro</code></a>

        <p>As an example of what <code>setf-expanderlet</code> can let one accomplish,
<code>with-resolved-places</code> is trivially implemented in terms of it.

        <p><strong>Implementation note:</strong> Surprisingly enough, this implementation
of <code>setf-expanderlet</code> is written fully portably. As far as I can
tell, the only caveat is that the name of the local setf-expander is
unconditionally made a local macro. This macro, if used in a non-place
context, simply expands to a form that evaluates the subforms and then
reads the place.

        <p>In contrast, &ldquo;real&rdquo; setf-expanders as defined by
<code>define-setf-expander</code> don't affect the semantics of the operator
in non-place contexts, which is useful if the operator is a
function. However, if the original operator is simple enough that it's
implemented as a function, you can probably just use a local setf
function anyway so I don't think the aforementioned caveat is very
important. 
</p></blockquote></div>

   </body></html>

